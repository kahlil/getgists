/*! jQuery GetGists Plugin - v0.1.0 - 2012-10-09
* https://github.com/tvooo/getgists
* Copyright (c) 2012 Tim von Oldenburg; Licensed MIT */
(function(e,t,n,r){"use strict";function o(t,n){this.element=t,this.options=e.extend({},s,n),this._defaults=s,this._name=i}var i="getGists",s={count:10,outputElem:"div"};n._write=n.write,n.write=function(e){if(e.indexOf('<div id="gist-')!==0){e.indexOf("https://gist.github.com/stylesheets/gist/embed.css")===-1&&n._write(e);return}var t=/<div id=\"gist-(\d+)/.exec(e)[1],r=n.querySelector('script[src="https://gist.github.com/'+t+'.js"]'),i=n.createElement("div");i.innerHTML=e,r.parentNode.innerHTML=e},o.prototype={insertGistCSS:function(){e('link[href="https://gist.github.com/stylesheets/gist/embed.css"]').length||e("<link>").attr({rel:"stylesheet",href:"https://gist.github.com/stylesheets/gist/embed.css"}).appendTo(e("head"))},fetchGists:function(t,n){var r="";t.user?r="/users/"+t.user+"/gists":e.error("No user name provided."),e.ajax({method:"get",dataType:"json",url:"https://api.github.com"+r,success:e.proxy(function(r,i,s){var o=e.grep(r,e.proxy(function(e,n){return this.filter(t,e)},this)),u=o.slice(0,t.count);n(u)},this),error:function(e,t,n){return n}})},fetchGist:function(){e.error("Not yet implemented")},filter:function(e,t){if(e.language!==r&&typeof e.language=="string"&&e.language.length){var n=!1;for(var i in t.files)t.files[i].language&&t.files[i].language.toLowerCase()===e.language.toLowerCase()&&(n=!0);if(!n)return!1}return e.keyword!==r&&typeof e.keyword=="string"&&e.keyword.length&&t.description.toLowerCase().indexOf(e.keyword.toLowerCase())===-1?!1:!0},list:function(t){return this.fetchGists(t,e.proxy(function(e){t.success&&t.success(e)},this)),e},embed:function(){return this.insertGistCSS(),this.fetchGists(this.options,e.proxy(function(t){t.forEach(e.proxy(function(t){var r=n.createElement("script");r.type="text/javascript",r.src="https://gist.github.com/"+t.id+".js";var i=this.options.outputElem==="li"?e("<li>"):e("<div>");this.options.outputClass&&i.addClass(this.options.outputClass),i.get(0).appendChild(r),this.element.appendChild(i.get(0))},this)),this.options.success&&this.options.success()},this)),this}},e.fn[i]=function(t){if(this instanceof e)return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,(new o(this,t)).embed())});o.prototype.list(t)}})(jQuery,window,document);